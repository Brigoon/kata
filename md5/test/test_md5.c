
#include "unity.h"
#include "md5.h"
#include <stdlib.h>

void setUp(void) {
}

void tearDown(void) {
}

void test_MD5_Hello_Acceptance(void) {
    char str[] = "Hello, World!";
    uint8_t expectedHash[MD5_HASH_BYTES] = {
          0x65,
          0xA8,
          0xE2,
          0x7D,
          0x88,
          0x79,
          0x28,
          0x38,
          0x31,
          0xB6,
          0x64,
          0xBD,
          0x8B,
          0x7F,
          0x0A,
          0xD4,
    };
    uint8_t result[MD5_HASH_BYTES] = {0};
    MD5(str, result);
    TEST_ASSERT_EQUAL_UINT8_ARRAY(expectedHash, result, MD5_HASH_BYTES);
}

void test_PreProcess_Single_block_sized_string(void)
{
    char    str[]        = "Hash Browns";
    uint8_t expected[MD5_BLOCK_BYTES] = {
          0x48, 0x61, 0x73, 0x68, 0x20, 0x42, 0x72, 0x6F, 0x77, 0x6E, 0x73,
          0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
          0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
          0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
          0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
          0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x58,
    };
    uint8_t *result = MD5_PreProcess(str);
    TEST_ASSERT_EQUAL_UINT8_ARRAY(expected, result, MD5_BLOCK_BYTES);
    free(result);
}

void test_PreProcess_two_block_sized_string(void)
{
    char str[] =
          "I am the very model of the Modern Major General.  I am well versed "
          "in all things animal...you get the idea.";
    uint8_t expected[MD5_BLOCK_BYTES * 2] = {
          0x49, 0x20, 0x61, 0x6D, 0x20, 0x74, 0x68, 0x65, 0x20, 0x76, 0x65,
          0x72, 0x79, 0x20, 0x6D, 0x6F, 0x64, 0x65, 0x6C, 0x20, 0x6F, 0x66,
          0x20, 0x74, 0x68, 0x65, 0x20, 0x4D, 0x6F, 0x64, 0x65, 0x72, 0x6E,
          0x20, 0x4D, 0x61, 0x6A, 0x6F, 0x72, 0x20, 0x47, 0x65, 0x6E, 0x65,
          0x72, 0x61, 0x6C, 0x2E, 0x20, 0x20, 0x49, 0x20, 0x61, 0x6D, 0x20,
          0x77, 0x65, 0x6C, 0x6C, 0x20, 0x76, 0x65, 0x72, 0x73, 0x65, 0x64,
          0x20, 0x69, 0x6E, 0x20, 0x61, 0x6C, 0x6C, 0x20, 0x74, 0x68, 0x69,
          0x6E, 0x67, 0x73, 0x20, 0x61, 0x6E, 0x69, 0x6D, 0x61, 0x6C, 0x2E,
          0x2E, 0x2E, 0x79, 0x6F, 0x75, 0x20, 0x67, 0x65, 0x74, 0x20, 0x74,
          0x68, 0x65, 0x20, 0x69, 0x64, 0x65, 0x61, 0x2E, 0x80, 0x00, 0x00,
          0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
          0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x58,
    };
    uint8_t *result = MD5_PreProcess(str);
    TEST_ASSERT_EQUAL_UINT8_ARRAY(expected, result, MD5_BLOCK_BYTES);
    free(result);
}

int main(void) {
    UNITY_BEGIN();
    RUN_TEST(test_MD5_Hello_Acceptance);
    RUN_TEST(test_PreProcess_Single_block_sized_string);
    RUN_TEST(test_PreProcess_two_block_sized_string);
    return UNITY_END();
}
